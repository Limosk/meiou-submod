
#Adds some converts when colony starts
MN_AddOwnerRel = {
	#Conversion to the owner religion, exporting it as a key
	export_to_key = {
		 lhs = DG_Tmp1
		 value = religion
		 who = owner
	}
	#Adds the religion in case it isn't there already
	MN_AddReligion = {
		type = which religion = DG_Tmp1
	}
	set_key = { lhs = DG_Tmp2 which = MN_S0Rural }
	multiply_key = { lhs = DG_Tmp2 value = 0.10 }
	set_key = { lhs = DG_Tmp3 which = MN_S0Urban }
	multiply_key = { lhs = DG_Tmp3 value = 0.10 }
	set_key = { lhs = DG_Tmp4 which = MN_S0Notables }
	multiply_key = { lhs = DG_Tmp4 value = 0.10 }
	MN_ConvertReligion = {
		typeFrom = which from = MN_S0	# From, as in the religion who is losing its believers
		typeTo = which to = DG_Tmp1   # To, as in the religion who is gaining new believers
		typeChange = which    # Change, as in how many people in absolute numbers are changing
		ruralChange = DG_Tmp2 urbanChange = DG_Tmp3 notablesChange = DG_Tmp4
	}
	set_key = { lhs = DG_Tmp1 value = 0 }
	set_key = { lhs = DG_Tmp2 value = 0 }
	set_key = { lhs = DG_Tmp3 value = 0 }
	set_key = { lhs = DG_Tmp4 value = 0 }
	MN_GetSlot_Class = yes
	#Converts the religion if necessary, and switches slots between former and new religion
	province_event = { id = DG_Convert.004 days = 1 } #change_religion_effect = yes
}

#Makes sure owner has his religion set.
MN_ConvColoHelper = {
	if = {
		limit = {
			is_key_equal = { lhs = MN_S$slot$ which = DG_Tmp1 }
		}

		#Changing numbers in population numbers
		change_key = { lhs = MN_S$slot$RurN value = 0.038 }
		change_key = { lhs = MN_S$slot$UrbN value = 0.000 }
		change_key = { lhs = MN_S$slot$NotN value = 0.025 }
		
		#Re-calculating of the propotions of each religious groups
		set_key = { lhs = MN_S$slot$Rural which = MN_S$slot$RurN }
		set_key = { lhs = MN_S$slot$Urban which = MN_S$slot$UrbN }
		set_key = { lhs = MN_S$slot$Notables which = MN_S$slot$NotN }
		if = {
			limit = { is_key_equal = { lhs = Class_Rural value = 0 } }
			set_key = { lhs = MN_S$slot$Rural value = 0 }
		}
		else = {
			divide_key = { lhs = MN_S$slot$Rural which = Class_Rural }
		}
		if = {
			limit = { is_key_equal = { lhs = Class_Urban value = 0 } }
			set_key = { lhs = MN_S$slot$Urban value = 0 }
		}
		else = {
			divide_key = { lhs = MN_S$slot$Urban which = Class_Urban }
		}
		if = {
			limit = { is_key_equal = { lhs = Class_Notables value = 0 } }
			set_key = { lhs = MN_S$slot$Notables value = 0 }
		}
		else = {
			divide_key = { lhs = MN_S$slot$Notables which = Class_Notables }
		}

		set_key = { lhs = MN_S$slot$RurP which = MN_S$slot$Rural }
		set_key = { lhs = MN_S$slot$UrbP which = MN_S$slot$Urban }
		set_key = { lhs = MN_S$slot$NotP which = MN_S$slot$Notables }
		multiply_key = { lhs = MN_S$slot$RurP value = 100 }
		multiply_key = { lhs = MN_S$slot$UrbP value = 100 }
		multiply_key = { lhs = MN_S$slot$NotP value = 100 }
		
		#Calculating the total number for each religious groups
		set_key = { lhs = MN_S$slot$TotN which = MN_S$slot$RurN }
		change_key = { lhs = MN_S$slot$TotN which = MN_S$slot$UrbN }
		change_key = { lhs = MN_S$slot$TotN which = MN_S$slot$NotN }
		
		set_key = { lhs = MN_S$slot$TotP which = MN_S$slot$TotN }
		divide_key = { lhs = MN_S$slot$TotP which = Class_Total }
		multiply_key = { lhs = MN_S$slot$TotP value = 100 }
	}
}

MN_ConvColo = {
	#Conversion to the owner religion, exporting it as a key
	export_to_key = {
		 lhs = DG_Tmp1
		 value = religion
		 who = owner
	}
	MN_ConvColoHelper = { slot = 0 }
	MN_ConvColoHelper = { slot = 1 }
	MN_ConvColoHelper = { slot = 2 }
	MN_ConvColoHelper = { slot = 3 }
	MN_ConvColoHelper = { slot = 4 }
	MN_ConvColoHelper = { slot = 5 }
	set_key = { lhs = DG_Tmp1 value = 0 }
	#Converts the religion if necessary, and switches slots between former and new religion
	province_event = { id = DG_Convert.004 days = 1 } #change_religion_effect = yes
}
